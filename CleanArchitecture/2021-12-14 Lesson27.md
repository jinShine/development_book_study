# 아키텍처란: '크고 작은 모든' 서비스들

### 서비스 아키텍처

프로세스나 플랫폼 경계를 가로지르는 함수 호출에 지나지 않는 '서비스' 라는 것은 아키텍처 관점에서 중요한 서비스도 있지만, 중요하지 않은 서비스도 존재함.
서비스 아키텍처가 주는 이점들에 대해 저자는 이야기하고있다.

### 결합 분리의 오류

시스템을 서비스들로 분리함으로써

서비스 사이의 결합이 확실히 분리된다는 이점이 있음.

→ 모든 서비스 인터페이스가 잘 정의 되어있으며 서비스는 다른 서비스 변수에 직접 접근할 수 없어야 함.

그러나

1. 서비스 사이를 오가는 데이터 레코드에 새로운 필드를 추가한다면 이 필드를 사용하는 서비스는 모두 변경되어야함.
2. 서비스들은 이 필드에 담긴 데이터를 해석하는 방식을 사전에 완벽하게 조율 해야함.

따라서 서비스들은 데이터 레코드에 강하게 결합되어 서비스들 간에 간접적인 결합이 생김.

### 개발 및 배포 독립성의 오류

대규모 엔터프라이즈 시스템을 독립적으로 개발하고 배포 가능한, 수십, 수백 ...개의 서비스들을 이용하여 만들 수 있으며 이러한 개발 및 배포 독립성으로 확장 가능 또한 가능함.

그러나

1. 서비스 기반 시스템 이외에도 모노리틱, 컴포넌트 기반 시스템으로도 구축하여 확장가능하기 때문에 서비스 기반이 유일한 선택지는 아님.
2. '결합 분리의 오류'에 따르면 서비스가 항상 독립적으로 개발, 배포, 운영할 수 있는 것은 아님.

### 야옹이 문제

![스크린샷 2021-12-16 오전 1.21.04.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fce6b75d-e589-415b-8ee2-4debf7fe81e6/스크린샷_2021-12-16_오전_1.21.04.png)

택시 통합서비스를 구현하기 위해 배치된 서비스들

특징을 보면 기능적으로 분해되어있음.

이로인해 서비스가 모두 결합되어있어 추가로 예를들어 야옹이 배달 기능을 구현하려면 기존 서비스를 전부다 변경해야함.

독립적으로 개발하고 배포하거나 유지될 수 없음.

→ 횡단 관심사가 지닌 문제. (서비스 지향이든 아니든 모든 SW이 문제에 직면함.)

### 객체가 구출하다.

이문제는 컴포넌트 기반 아키텍처에서 해결가능.

![스크린샷 2021-12-16 오전 1.21.30.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8f2f2115-f2bb-4edc-9d60-ab0bd3802ed8/스크린샷_2021-12-16_오전_1.21.30.png)

기능적으로 분해된 다이어그램에서 새로운 야옹이라는 기능이 기능적 행위를 횡단하는 상황이였지만
다형적으로 확장할 수 있는 클래스 집합을 생성해 새로운 야옹이 기능을 처리함.
따라서 야옹이 기능은 결합이 분리되며, 독립적으로 개발, 배포할 수 있음.

### 컴포넌트 기반 서비스

서비스가 반드시 소규모 단일체 *monolith* 여야 할 이유는 없다. 서비스는 SOLID 원칙대로 설계할 수 있으며 컴포넌트 구조를 갖출 수도 있다. 이를 통해 서비스 내의 기존 컴포넌트들을 변경하기 않고도 새로운 컴포넌트를 추가할 수 있다.

![스크린샷 2021-12-16 오전 1.24.52.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6b3276d9-3420-4415-9b32-22ad0f25159f/스크린샷_2021-12-16_오전_1.24.52.png)

위 그림의 서비스 다이어그램에서 서비스들의 존재는 이전과 달라진게 없지만, 각 서비스의 내부는 자신만의 컴포넌트 설계로 되어 있어서 파생 클래스를 만드는 방식으로 신규 기능을 추가할 수 있다. 파생 클래스들은 각자의 컴포넌트 내부에 놓인다.

### 횡단 관심사

아키텍처 경계가 서비스 사이에 있지 않고, 서비스를 관통하며 서비스를 컴포넌트 단위로 분할한다.

모든 주요 시스템이 직면하는 횡단 관심사를 처리하려면, 아래 다이어그램처럼 서비스 내부의 **의존성 규칙** 도 준수하는 컴포넌트 아키텍처로 설계해야 한다. 이 서비스들은 시스템의 아키텍처 경계를 정의하지 않는다. 아키텍처 경계를 정의하는 것은 서비스 내에 위치한 컴포넌트다.

![스크린샷 2021-12-16 오전 1.26.53.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1e20a791-895f-4851-b4e4-e448646c8934/스크린샷_2021-12-16_오전_1.26.53.png)

### 결론

서비스는 시스템의 확장성과 개발 가능성 측면에서는 유용하지만, 그 자체로는 아키텍처적으로 그리 중요한 요소는 아니다. 시스템의 아키텍처는 시스템 내부에 그어진 경계를 넘나드는 의존성에 의해 정의된다.
