## 9. 단위 테스트

### TDD 세가지 법칙

1. 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
2. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위테스트를 작성한다.
3. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

### 깨끗한 테스트 코드 유지하기

지저분한 테스트 코드는 안하는만 못하며, 복잡할수록 실제 코드를 짜는 시간보다 테스트케이스를 추가하는 시간이 더 걸린다.

### 도메인에 특화된 테스트 언어

도메인 특화 언어(DSL)이란 단어 자체로는 "특정 문제에 맞는 언어"라고 볼 수 있지만  특정 영역의 해결에는 그 영역에 맞는 특화된 도구를 사용하고 비즈니스에 초점을 맞춘 개념

단위 테스트 메서드를 만들때 각각의 비즈니스별로 간결하고 표현력있게 만들자

### 테스트는 유연성, 유지보수성, 재사용성을 제공한다.

테스트 코드를 깨끗하게 유지하지 않으면 결국 잃어 버린다.

테스트 케이스가 있으면 변경이 두렵지 않아 테스트가 유연성, 유지보수성, 재사용성을 제공한다고 볼 수 있다.

### 깨끗한 테스트 코드

그렇다면 깨끗한 테스트 코드를 만들기 위해서는? 가독성이 필요하다.

**테스트 당 assert 하나씩, 개념 하나씩**

assert를 한개씩 쪼개면 중복되는 어쩔수 없이 코드가 많아진다.  
하지만, Template method패턴을 이용해서 부모 클래스엔 given/when를 두고 then부분을 자식 클래스에 만들어 두면 중복을 제거 하는 방법이 있다.

함수에 여러 assert를 넣는것도 좋지만 함수에 assert를 최대한 줄이는것이 좋다.  
또한 하나의 함수에 여러 가지 개념을 가진 테스트는 피해야된다.

즉, **테스트 함수 하나는 개념 하나만 테스트하고, 개념 당 assert문 수를 최소로 줄여라**

**F.I.R.S.T**

- Fast **빠르게** : 테스트는 빨라야 한다. 자주 돌릴 것이기 때문이다.
- Independent **독립적으로** : 테스트끼리 의존하면 안 된다. 하나가 실패할 때 다른 하나도 실패하면 원인 진단이 어렵기 때문이다. 의존성을 깨트리기위해 DIP를 이용한다.
- Repeatable **반복가능하게**: QA 환경, 네트워크 환경에 제한없이 반복해서 테스트할 수 있어야 한다. 테스트가 실패할 환경이 하나라도 있다면 변명할 여지가 생긴다.
- Self-Validating **자가 검증하는**: bool값으로 결과를 내야 한다. 성공/실패로 가늠하지 않으면 판단은 주관적이 되며 수작업 평가가 필요해진다.
- Timely **적시에**: 실제 코드를 작성하기 직전에 구현해야 한다. 실제 코드를 구현한 다음에 테스트 코드를 작성하면 실제 코드가 테스트 하기 어렵다는 사실을 발견할 수도 있기 때문이다.